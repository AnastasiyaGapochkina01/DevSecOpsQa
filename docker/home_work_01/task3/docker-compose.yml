version: '3.8'
services:
  redis:
    image: redis:alpine
    command: redis-server --maxmemory 32mb --save "" --appendonly no
    mem_limit: 64m
    memswap_limit: 128m
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 10s
    restart: unless-stopped
    networks:
      - app-network

  web:
    build: ./app
    ports:
      - "5001:5000"
    mem_limit: 128m
    memswap_limit: 256m
    depends_on:
      redis:
        condition: service_healthy
    restart: unless-stopped
    networks:
      - app-network
    environment:
      - PYTHONUNBUFFERED=1
      - FLASK_DEBUG=0

networks:
  app-network:
    driver: bridge
